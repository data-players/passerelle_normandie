{"ast":null,"code":"import { getIn } from 'final-form';\n\nvar isPromise = function (obj) {\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function';\n}; //      \n\n\nvar tripleEquals = function tripleEquals(a, b) {\n  return a === b;\n};\n\nvar createDecorator = function createDecorator() {\n  for (var _len = arguments.length, calculations = new Array(_len), _key = 0; _key < _len; _key++) {\n    calculations[_key] = arguments[_key];\n  }\n\n  return function (form) {\n    var previousValues = {};\n    var unsubscribe = form.subscribe(function (_ref) {\n      var values = _ref.values;\n      form.batch(function () {\n        var runUpdates = function runUpdates(field, isEqual, updates) {\n          var next = values && getIn(values, field);\n          var previous = previousValues && getIn(previousValues, field);\n\n          if (!isEqual(next, previous)) {\n            if (typeof updates === 'function') {\n              var results = updates(next, field, values, previousValues);\n\n              if (isPromise(results)) {\n                results.then(function (resolved) {\n                  Object.keys(resolved).forEach(function (destField) {\n                    form.change(destField, resolved[destField]);\n                  });\n                });\n              } else {\n                Object.keys(results).forEach(function (destField) {\n                  form.change(destField, results[destField]);\n                });\n              }\n            } else {\n              Object.keys(updates).forEach(function (destField) {\n                var update = updates[destField];\n                var result = update(next, values, previousValues);\n\n                if (isPromise(result)) {\n                  result.then(function (resolved) {\n                    form.change(destField, resolved);\n                  });\n                } else {\n                  form.change(destField, result);\n                }\n              });\n            }\n          }\n        };\n\n        var fields = form.getRegisteredFields();\n        calculations.forEach(function (_ref2) {\n          var field = _ref2.field,\n              isEqual = _ref2.isEqual,\n              updates = _ref2.updates;\n\n          if (typeof field === 'string') {\n            runUpdates(field, isEqual || tripleEquals, updates);\n          } else {\n            // field is a either array or regex\n            var matches = Array.isArray(field) ? function (name) {\n              return ~field.indexOf(name) || field.findIndex(function (f) {\n                return f instanceof RegExp && f.test(name);\n              }) !== -1;\n            } : function (name) {\n              return field.test(name);\n            };\n            fields.forEach(function (fieldName) {\n              if (matches(fieldName)) {\n                runUpdates(fieldName, isEqual || tripleEquals, updates);\n              }\n            });\n          }\n        });\n        previousValues = values;\n      });\n    }, {\n      values: true\n    });\n    return unsubscribe;\n  };\n}; //\n\n\nexport default createDecorator;","map":{"version":3,"sources":["/app/node_modules/final-form-calculate/dist/final-form-calculate.es.js"],"names":["getIn","isPromise","obj","then","tripleEquals","a","b","createDecorator","_len","arguments","length","calculations","Array","_key","form","previousValues","unsubscribe","subscribe","_ref","values","batch","runUpdates","field","isEqual","updates","next","previous","results","resolved","Object","keys","forEach","destField","change","update","result","fields","getRegisteredFields","_ref2","matches","isArray","name","indexOf","findIndex","f","RegExp","test","fieldName"],"mappings":"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","sourcesContent":["import { getIn } from 'final-form';\n\nvar isPromise = (function (obj) {\n  return !!obj && (typeof obj === 'object' || typeof obj === 'function') && typeof obj.then === 'function';\n});\n\n//      \n\nvar tripleEquals = function tripleEquals(a, b) {\n  return a === b;\n};\n\nvar createDecorator = function createDecorator() {\n  for (var _len = arguments.length, calculations = new Array(_len), _key = 0; _key < _len; _key++) {\n    calculations[_key] = arguments[_key];\n  }\n\n  return function (form) {\n    var previousValues = {};\n    var unsubscribe = form.subscribe(function (_ref) {\n      var values = _ref.values;\n      form.batch(function () {\n        var runUpdates = function runUpdates(field, isEqual, updates) {\n          var next = values && getIn(values, field);\n          var previous = previousValues && getIn(previousValues, field);\n\n          if (!isEqual(next, previous)) {\n            if (typeof updates === 'function') {\n              var results = updates(next, field, values, previousValues);\n\n              if (isPromise(results)) {\n                results.then(function (resolved) {\n                  Object.keys(resolved).forEach(function (destField) {\n                    form.change(destField, resolved[destField]);\n                  });\n                });\n              } else {\n                Object.keys(results).forEach(function (destField) {\n                  form.change(destField, results[destField]);\n                });\n              }\n            } else {\n              Object.keys(updates).forEach(function (destField) {\n                var update = updates[destField];\n                var result = update(next, values, previousValues);\n\n                if (isPromise(result)) {\n                  result.then(function (resolved) {\n                    form.change(destField, resolved);\n                  });\n                } else {\n                  form.change(destField, result);\n                }\n              });\n            }\n          }\n        };\n\n        var fields = form.getRegisteredFields();\n        calculations.forEach(function (_ref2) {\n          var field = _ref2.field,\n              isEqual = _ref2.isEqual,\n              updates = _ref2.updates;\n\n          if (typeof field === 'string') {\n            runUpdates(field, isEqual || tripleEquals, updates);\n          } else {\n            // field is a either array or regex\n            var matches = Array.isArray(field) ? function (name) {\n              return ~field.indexOf(name) || field.findIndex(function (f) {\n                return f instanceof RegExp && f.test(name);\n              }) !== -1;\n            } : function (name) {\n              return field.test(name);\n            };\n            fields.forEach(function (fieldName) {\n              if (matches(fieldName)) {\n                runUpdates(fieldName, isEqual || tripleEquals, updates);\n              }\n            });\n          }\n        });\n        previousValues = values;\n      });\n    }, {\n      values: true\n    });\n    return unsubscribe;\n  };\n};\n\n//\n\nexport default createDecorator;\n"]},"metadata":{},"sourceType":"module"}